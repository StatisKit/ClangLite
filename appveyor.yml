platform:
  - x64

environment:
  CONDA_CACHE_DIR: '%SystemDrive%\cache'
  matrix:
    - BUILD_TARGETS: libllvm
      MINICONDA: "3"
    - BUILD_TARGETS: libclang
      MINICONDA: "3"
    - BUILD_TARGETS: libclanglite
      MINICONDA: "3"
    - BUILD_TARGETS: python-clanglite
      MINICONDA: "3"

cache:
  - '%CONDA_CACHE_DIR%'

install:
  - dir %SystemDrive%\cache
  - git clone https://gist.github.com/a08b6eb1c97fad864de50601d70008c8.git config-appveyor
  - cd config-appveyor
  - call config.bat
  - cd ..
  - dir %SystemDrive%\cache

build_script:
  - dir %SystemDrive%\cache
  - cd conda
  - '%CMD_IN_ENV% call bld.bat'
  - cd ..
  - dir %SystemDrive%\cache
  
on_success:
  - cd conda
  - if "%APPVEYOR_REPO_BRANCH%"=="master" if "%APPVEYOR_PULL_REQUEST_NUMBER%"=="" if not "%ANACONDA_USERNAME%"=="" call upload.bat
  - cd ..
